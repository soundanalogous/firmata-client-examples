/* global require */
'use strict';

var BleSerialPort = require('../index').SerialPort;
var five = require('johnny-five');
var bsp = new BleSerialPort({address: 'd0:6a:cf:58:ee:bd'});

bsp.connect().then(function() {
  console.log('Ble Connected!');
  var board = new five.Board({port: bsp, repl: true});
  board.on('ready', function() {
    console.log('Arduino connected!');
    var led = new five.Led(7);
    led.on();
    var motorLeft = new five.Motor({
      invertPWM: true,
      pins: {
        pwm: 5,
        dir: 4
      }
    });
    var motorRight = new five.Motor({
      invertPWM: true,
      pins: {
        pwm: 3,
        dir: 2
      }
    });

    var eyes = new five.IR.Reflect.Array({
      emitter: 13,
      pins: ['A0', 'A1', 'A2', 'A3', 'A4', 'A5']
    });
    /*
    var calibrating = true;
    eyes.calibrateUntil(function() {
      return !calibrating;
    });

    setTimeout(function() { calibrating = false; }, 2000 );

    eyes.on('line', function(err) {
      console.log('line: ', this.line);
    });
    */
    eyes.on('data', function(err) {
      console.log('data: ', this.raw);
    });
    eyes.enable();

    board.repl.inject({
      motorLeft: motorLeft,
      motorRight: motorRight,
      eyes: eyes
    });
  });
});
